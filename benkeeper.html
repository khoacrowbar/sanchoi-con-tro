<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>🎨 ManiaCurse — Community</title>
<style>
  :root{
    --bg:#0f1720; --panel:#111318; --muted:#9aa3b2; --accent:#22c1ff;
    --gap:10px;
  }
  *{box-sizing:border-box}
  body{margin:0; font-family:Inter, system-ui, Roboto, Arial; background:var(--bg); color:#e6eef6;}
  .wrap{max-width:1200px; margin:18px auto; padding:12px;}
  header{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px}
  h1{font-size:20px; margin:0}
  .topbar{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
  .tool{background:var(--panel); padding:8px; border-radius:8px; display:flex; gap:8px; align-items:center;}
  select,input[type=color],input[type=text],input[type=password],button,input[type=file],input[type=range]{border-radius:6px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:inherit; padding:6px;}
  button{cursor:pointer; background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);}
  button.primary{background:var(--accent); color:#022; font-weight:700;}
  main{display:flex; gap:12px; align-items:flex-start}
  .editor{flex:1; background:var(--panel); padding:12px; border-radius:10px}
  .sidebar{width:340px; background:var(--panel); padding:12px; border-radius:10px}
  .small{font-size:13px; color:var(--muted)}
  .canvas-wrap{display:flex; gap:12px; align-items:flex-start; flex-wrap:wrap}
  canvas#canvas{border:1px solid rgba(255,255,255,0.04); background:#fff; image-rendering:pixelated; cursor:crosshair}
  .vbox{display:flex; flex-direction:column; gap:8px}
  .box{background:rgba(255,255,255,0.02); padding:8px; border-radius:8px}
  .thumb{width:64px;height:64px;border:1px solid rgba(255,255,255,0.04); image-rendering:pixelated; display:block}
  .gallery{display:flex; flex-direction:column; gap:8px; max-height:360px; overflow:auto; padding-right:6px}
  .gallery-item{display:flex; align-items:center; justify-content:space-between; gap:8px; background:rgba(0,0,0,0.05); padding:6px; border-radius:6px}
  .g-left{display:flex; gap:8px; align-items:center}
  .muted{color:var(--muted)}
  .form-row{display:flex; gap:8px}
  footer{margin-top:12px; color:var(--muted); font-size:13px; text-align:center}
  @media (max-width:900px){ main{flex-direction:column} .sidebar{width:100%} .topbar{justify-content:flex-start} }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>🎨 Sân chơi tạo con trỏ pixel</h1>
    <div class="topbar" id="topbar">
      <div class="tool">
        <label class="small">Kích thước:</label>
        <select id="cursorSize"><option value="16">16×16</option><option value="32" selected>32×32</option><option value="48">48×48</option><option value="64">64×64</option></select>
      </div>

      <div class="tool">
        <label class="small">Màu:</label>
        <input id="color" type="color" value="#000000">
        <button id="erase" title="Toggle erase">🧽</button>
        <button id="clear" title="Xóa hết">🧹</button>
      </div>

      <div class="tool">
        <label class="small">Zoom ô:</label>
        <input id="pixelZoom" type="range" min="6" max="40" value="18">
        <span id="pixelZoomVal" class="small">18</span>
      </div>

      <div class="tool">
        <button id="savePNG" class="primary">💾 Lưu PNG</button>
        <input id="loadPNG" type="file" accept="image/png" style="display:none">
        <button id="importPNG">📂 Nạp PNG</button>
        <button id="apply" title="Áp dụng làm con trỏ">🖱️ Apply</button>
      </div>

      <div class="tool" id="authTop">
        <div id="authButtons">
          <button id="showLoginBtn">Đăng nhập</button>
          <button id="showRegisterBtn">Đăng ký</button>
        </div>
        <div id="userInfo" style="display:none; gap:8px; align-items:center">
          <span id="userName" class="small"></span>
          <button id="logoutBtn">Đăng xuất</button>
        </div>
      </div>
    </div>
  </header>

  <main>
    <section class="editor">
      <div class="small box">Hướng dẫn ngắn: Chọn kích thước con trỏ → chọn màu → click/giữ chuột kéo để vẽ. Dùng Erase để tẩy từng ô.</div>

      <div class="canvas-wrap" style="margin-top:10px;">
        <canvas id="canvas"></canvas>

        <div class="vbox" style="min-width:220px">
          <div class="box">
            <div><strong>Xem trước</strong></div>
            <canvas id="preview" width="128" height="128" class="thumb"></canvas>
          </div>

          <div class="box">
            <label class="small">Tên con trỏ (khi lưu):</label>
            <input id="saveName" type="text" placeholder="Ví dụ: my-arrow">
            <div style="display:flex; gap:8px; margin-top:8px;">
              <button id="saveToAccount" class="primary">Lưu vào tài khoản</button>
              <button id="publishToCommunity">📢 Đăng lên cộng đồng</button>
            </div>
            <div class="small muted" style="margin-top:6px;">Lưu vào tài khoản / đăng lên cộng đồng yêu cầu đăng nhập.</div>
          </div>

          <div class="box small muted">
            <div><strong>Hành động nhanh</strong></div>
            <div style="display:flex; gap:8px; margin-top:8px; flex-wrap:wrap;">
              <button id="downloadPNG">Tải PNG</button>
              <button id="resetAll">Reset (xóa local data)</button>
            </div>
          </div>
        </div>
      </div>

    </section>

    <aside class="sidebar">
      <div class="box">
        <strong>Tài khoản (local)</strong>
        <div id="authForms" class="small"></div>
      </div>

      <div class="box" style="margin-top:12px;">
        <strong>Gallery cá nhân</strong>
        <div id="myGallery" class="gallery small muted">(Đăng nhập để thấy mục đã lưu)</div>
      </div>

      <div class="box" style="margin-top:12px;">
        <strong>Bộ sưu tập cộng đồng</strong>
        <div id="communityGallery" class="gallery small muted">(Đăng nhập để xem bộ sưu tập cộng đồng)</div>
      </div>
    </aside>
  </main>

  <footer>Local-only demo — dữ liệu lưu cục bộ trên trình duyệt. Muốn đồng bộ thật thì cần backend.</footer>
</div>

<script>
/* ============== storage keys & helpers =============== */
const LS_USERS = 'cp_users_v1';
const LS_COMMUNITY = 'cp_community_v1';

function loadUsers(){ try{ return JSON.parse(localStorage.getItem(LS_USERS) || '{}'); }catch(e){return{}} }
function saveUsers(u){ localStorage.setItem(LS_USERS, JSON.stringify(u)); }

function loadCommunity(){ try{ return JSON.parse(localStorage.getItem(LS_COMMUNITY) || '[]'); }catch(e){ return []; } }
function saveCommunity(list){ localStorage.setItem(LS_COMMUNITY, JSON.stringify(list)); }

/* ============== UI elements =============== */
const canvas = document.getElementById('canvas'), ctx = canvas.getContext('2d');
const preview = document.getElementById('preview'), pctx = preview.getContext('2d');

const cursorSize = document.getElementById('cursorSize');
const colorEl = document.getElementById('color');
const eraseBtn = document.getElementById('erase');
const clearBtn = document.getElementById('clear');
const pixelZoom = document.getElementById('pixelZoom');
const pixelZoomVal = document.getElementById('pixelZoomVal');

const savePNG = document.getElementById('savePNG');
const loadPNG = document.getElementById('loadPNG');
const importPNG = document.getElementById('importPNG');
const applyBtn = document.getElementById('apply');

const showLoginBtn = document.getElementById('showLoginBtn');
const showRegisterBtn = document.getElementById('showRegisterBtn');
const authForms = document.getElementById('authForms');
const authButtons = document.getElementById('authButtons');
const userInfo = document.getElementById('userInfo');
const userNameSpan = document.getElementById('userName');
const logoutBtn = document.getElementById('logoutBtn');

const saveToAccountBtn = document.getElementById('saveToAccount');
const publishBtn = document.getElementById('publishToCommunity');
const saveNameInput = document.getElementById('saveName');
const myGalleryEl = document.getElementById('myGallery');
const communityGalleryEl = document.getElementById('communityGallery');
const downloadPNGbtn = document.getElementById('downloadPNG');
const resetAllBtn = document.getElementById('resetAll');

/* ============== editor state =============== */
let gridSize = parseInt(cursorSize.value,10);
let zoom = parseInt(pixelZoom.value,10);
let pixels = createEmpty(gridSize);
let drawing=false, eraseMode=false, currentColor=colorEl.value;
let users = loadUsers();
let currentUser = null;
let community = loadCommunity();

function createEmpty(n){ return Array.from({length:n},()=>Array(n).fill(null)); }

function resizeGrid(newSize){
  const newGrid = createEmpty(newSize);
  const min = Math.min(newSize, pixels.length);
  for(let y=0;y<min;y++) for(let x=0;x<min;x++) newGrid[y][x] = pixels[y][x];
  pixels = newGrid; gridSize = newSize; drawGrid();
}

function drawGrid(){
  canvas.width = gridSize * zoom; canvas.height = gridSize * zoom;
  ctx.imageSmoothingEnabled = false; ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let y=0;y<gridSize;y++){
    for(let x=0;x<gridSize;x++){
      ctx.fillStyle = pixels[y][x] || '#ffffff';
      ctx.fillRect(x*zoom, y*zoom, zoom, zoom);
      ctx.strokeStyle = 'rgba(0,0,0,0.06)'; ctx.strokeRect(x*zoom,y*zoom,zoom,zoom);
    }
  }
  updatePreview();
}

function updatePreview(){
  const tmp = document.createElement('canvas'); tmp.width = gridSize; tmp.height = gridSize;
  const tctx = tmp.getContext('2d'); tctx.clearRect(0,0,tmp.width,tmp.height);
  for(let y=0;y<gridSize;y++) for(let x=0;x<gridSize;x++) if(pixels[y][x]){ tctx.fillStyle = pixels[y][x]; tctx.fillRect(x,y,1,1); }
  pctx.imageSmoothingEnabled = false; pctx.clearRect(0,0,preview.width,preview.height);
  pctx.drawImage(tmp,0,0, preview.width, preview.height);
}

/* painting */
function posFromEvent(e){
  const r=canvas.getBoundingClientRect();
  const x=Math.floor((e.clientX - r.left)/zoom), y=Math.floor((e.clientY - r.top)/zoom);
  return {x,y};
}
canvas.addEventListener('mousedown', e=>{ drawing=true; paint(e); });
canvas.addEventListener('mousemove', e=>{ if(drawing) paint(e); });
document.addEventListener('mouseup', ()=> drawing=false);
function paint(e){
  const {x,y}=posFromEvent(e);
  if(x<0||y<0||x>=gridSize||y>=gridSize) return;
  pixels[y][x] = eraseMode ? null : currentColor; drawGrid();
}

/* controls */
cursorSize.addEventListener('change', ()=> resizeGrid(parseInt(cursorSize.value,10)));
pixelZoom.addEventListener('input', ()=> { zoom = parseInt(pixelZoom.value,10); pixelZoomVal.textContent=zoom; drawGrid(); });
colorEl.addEventListener('input', ()=> { currentColor = colorEl.value; eraseMode=false; eraseBtn.style.background=''; });
eraseBtn.addEventListener('click', ()=> { eraseMode = !eraseMode; eraseBtn.style.background = eraseMode ? 'rgba(255,0,0,0.12)' : ''; });
clearBtn.addEventListener('click', ()=> { pixels = createEmpty(gridSize); drawGrid(); document.body.style.cursor='auto'; });

/* Save PNG (download) */
savePNG.addEventListener('click', ()=> {
  const tmp = document.createElement('canvas'); tmp.width=gridSize; tmp.height=gridSize;
  const tctx = tmp.getContext('2d'); tctx.clearRect(0,0,tmp.width,tmp.height);
  for(let y=0;y<gridSize;y++) for(let x=0;x<gridSize;x++) if(pixels[y][x]){ tctx.fillStyle=pixels[y][x]; tctx.fillRect(x,y,1,1); }
  tmp.toBlob(b=>{ const a=document.createElement('a'); a.href=URL.createObjectURL(b); a.download=`cursor_${gridSize}x${gridSize}.png`; a.click(); }, 'image/png');
});
downloadPNGbtn.addEventListener('click', ()=> savePNG.click());

/* Import PNG */
importPNG.addEventListener('click', ()=> loadPNG.click());
loadPNG.addEventListener('change', e=>{
  const f = e.target.files[0]; if(!f) return;
  const img = new Image();
  img.onload = ()=> {
    const w = img.width, h = img.height, size = Math.max(w,h);
    resizeGrid(size);
    const tmp = document.createElement('canvas'); tmp.width=w; tmp.height=h; const tctx = tmp.getContext('2d');
    tctx.drawImage(img,0,0,w,h); const data = tctx.getImageData(0,0,w,h).data;
    for(let yy=0; yy<size; yy++){ for(let xx=0; xx<size; xx++){
      const i = ((yy%h)*w + (xx%w))*4; const r=data[i], g=data[i+1], b=data[i+2], a=data[i+3];
      pixels[yy][xx] = a>0 ? `rgba(${r},${g},${b},${(a/255).toFixed(3)})` : null;
    } }
    drawGrid(); loadPNG.value='';
  };
  img.src = URL.createObjectURL(f);
});

/* apply as cursor */
applyBtn.addEventListener('click', ()=> {
  const tmp = document.createElement('canvas'); tmp.width=gridSize; tmp.height=gridSize;
  const tctx = tmp.getContext('2d'); tctx.clearRect(0,0,tmp.width,tmp.height);
  let any=false;
  for(let y=0;y<gridSize;y++) for(let x=0;x<gridSize;x++) if(pixels[y][x]){ tctx.fillStyle=pixels[y][x]; tctx.fillRect(x,y,1,1); any=true; }
  if(!any){ document.body.style.cursor='auto'; alert('Con trỏ trống — đã trả về mặc định.'); return; }
  const url = tmp.toDataURL('image/png'); document.body.style.cursor = `url(${url}) 0 0, auto`; alert('Con trỏ đã áp dụng trong tab này.');
});

/* ============== Auth system (local) ============== */
function b64(s){return btoa(String(s));}
function unb64(s){try{return atob(s)}catch(e){return ''}}

function renderAuth(){
  if(currentUser){
    authButtons.style.display='none'; userInfo.style.display='flex'; userNameSpan.textContent = currentUser;
    authForms.innerHTML = '';
    renderMyGallery();
    renderCommunity(); // allow viewing community
  } else {
    authButtons.style.display='flex'; userInfo.style.display='none';
    authForms.innerHTML = '';
    myGalleryEl.innerHTML = '(Đăng nhập để xem mục đã lưu)';
    communityGalleryEl.innerHTML = '(Đăng nhập để xem bộ sưu tập cộng đồng)';
  }
}
showRegisterBtn.addEventListener('click', ()=> {
  authForms.innerHTML = `<div class="form-row"><input id="regU" placeholder="username"><input id="regP" placeholder="password" type="password"><button id="doReg">Đăng ký</button></div>`;
  document.getElementById('doReg').addEventListener('click', ()=> {
    const u=document.getElementById('regU').value.trim(); const p=document.getElementById('regP').value;
    if(!u||!p){ alert('Điền username & password'); return; }
    users = loadUsers();
    if(users[u]){ alert('Username đã tồn tại'); return; }
    users[u] = { password: b64(p), cursors: [] };
    saveUsers(users); alert('Đăng ký thành công. Đăng nhập để tiếp tục.');
    authForms.innerHTML=''; 
  });
});
showLoginBtn.addEventListener('click', ()=> {
  authForms.innerHTML = `<div class="form-row"><input id="logU" placeholder="username"><input id="logP" placeholder="password" type="password"><button id="doLog">Đăng nhập</button></div>`;
  document.getElementById('doLog').addEventListener('click', ()=> {
    const u=document.getElementById('logU').value.trim(); const p=document.getElementById('logP').value;
    if(!u||!p){ alert('Điền username & password'); return; }
    users = loadUsers();
    if(!users[u] || users[u].password !== b64(p)){ alert('Sai thông tin'); return; }
    currentUser = u; renderAuth(); authForms.innerHTML='';
  });
});
logoutBtn.addEventListener('click', ()=> { currentUser = null; renderAuth(); });

/* save to account (user gallery) */
document.getElementById('saveToAccount').addEventListener('click', ()=> {
  if(!currentUser){ alert('Cần đăng nhập để lưu vào tài khoản'); return; }
  const name = (saveNameInput.value || `cursor_${new Date().toISOString()}`).trim();
  const tmp = document.createElement('canvas'); tmp.width=gridSize; tmp.height=gridSize;
  const tctx = tmp.getContext('2d'); tctx.clearRect(0,0,tmp.width,tmp.height);
  for(let y=0;y<gridSize;y++) for(let x=0;x<gridSize;x++) if(pixels[y][x]){ tctx.fillStyle = pixels[y][x]; tctx.fillRect(x,y,1,1); }
  const dataURL = tmp.toDataURL('image/png');
  users = loadUsers(); if(!users[currentUser]) users[currentUser] = { password:'', cursors:[] };
  users[currentUser].cursors.push({ name, dataURL, size:gridSize, createdAt: Date.now() });
  saveUsers(users); saveNameInput.value=''; renderMyGallery(); alert('Đã lưu vào gallery cá nhân.');
});

/* publish to community */
publishBtn.addEventListener('click', ()=> {
  if(!currentUser){ alert('Cần đăng nhập để đăng lên cộng đồng'); return; }
  const name = (saveNameInput.value || `cursor_${new Date().toISOString()}`).trim();
  const tmp = document.createElement('canvas'); tmp.width=gridSize; tmp.height=gridSize;
  const tctx = tmp.getContext('2d'); tctx.clearRect(0,0,tmp.width,tmp.height);
  let has=false;
  for(let y=0;y<gridSize;y++) for(let x=0;x<gridSize;x++) if(pixels[y][x]){ tctx.fillStyle=pixels[y][x]; tctx.fillRect(x,y,1,1); has=true; }
  if(!has){ alert('Con trỏ trống, không thể đăng'); return; }
  const dataURL = tmp.toDataURL('image/png');
  community = loadCommunity();
  community.push({ id: 'c_'+Date.now()+'_'+Math.floor(Math.random()*9999), name, author:currentUser, dataURL, size:gridSize, createdAt: Date.now() });
  saveCommunity(community); saveNameInput.value=''; renderCommunity(); alert('Đã đăng lên cộng đồng.');
});

/* render my gallery */
function renderMyGallery(){
  myGalleryEl.innerHTML = '';
  users = loadUsers();
  if(!currentUser || !users[currentUser] || !users[currentUser].cursors.length){ myGalleryEl.innerHTML = '<div class="small muted">Chưa có con trỏ nào.</div>'; return; }
  const list = users[currentUser].cursors.slice().reverse();
  list.forEach((it, idx)=> {
    const el = document.createElement('div'); el.className='gallery-item';
    const left = document.createElement('div'); left.className='g-left';
    const img = document.createElement('img'); img.src = it.dataURL; img.className='thumb';
    const meta = document.createElement('div'); meta.innerHTML = `<div style="font-weight:600">${escapeHtml(it.name)}</div><div class="small muted">${new Date(it.createdAt).toLocaleString()}</div>`;
    left.appendChild(img); left.appendChild(meta);
    const right = document.createElement('div');
    const loadBtn = document.createElement('button'); loadBtn.textContent='Load';
    const applyBtn = document.createElement('button'); applyBtn.textContent='Apply';
    const delBtn = document.createElement('button'); delBtn.textContent='Delete';
    loadBtn.addEventListener('click', ()=> loadImageToEditor(it.dataURL));
    applyBtn.addEventListener('click', ()=> { document.body.style.cursor = `url(${it.dataURL}) 0 0, auto`; alert('Đã áp dụng con trỏ.'); });
    delBtn.addEventListener('click', ()=> {
      if(!confirm('Xóa con trỏ này?')) return;
      users = loadUsers(); users[currentUser].cursors.splice(users[currentUser].cursors.length-1-idx,1); saveUsers(users); renderMyGallery();
    });
    [loadBtn,applyBtn,delBtn].forEach(b=> b.style.margin='4px');
    right.appendChild(loadBtn); right.appendChild(applyBtn); right.appendChild(delBtn);
    el.appendChild(left); el.appendChild(right);
    myGalleryEl.appendChild(el);
  });
}

/* render community gallery */
function renderCommunity(){
  community = loadCommunity();
  communityGalleryEl.innerHTML = '';
  if(!currentUser){ communityGalleryEl.innerHTML = '<div class="small muted">(Đăng nhập để xem bộ sưu tập cộng đồng)</div>'; return; }
  if(!community.length){ communityGalleryEl.innerHTML = '<div class="small muted">Chưa có bài đăng cộng đồng.</div>'; return; }
  // newest first
  community.slice().reverse().forEach(item => {
    const el = document.createElement('div'); el.className='gallery-item';
    const left = document.createElement('div'); left.className='g-left';
    const img = document.createElement('img'); img.src = item.dataURL; img.className='thumb';
    const meta = document.createElement('div'); meta.innerHTML = `<div style="font-weight:600">${escapeHtml(item.name)}</div><div class="small muted">by ${escapeHtml(item.author)} — ${new Date(item.createdAt).toLocaleString()}</div>`;
    left.appendChild(img); left.appendChild(meta);
    const right = document.createElement('div');
    const loadBtn = document.createElement('button'); loadBtn.textContent='Load';
    const applyBtn = document.createElement('button'); applyBtn.textContent='Apply';
    const reportBtn = document.createElement('button'); reportBtn.textContent='Report';
    // if currentUser is author allow delete
    const deleteBtn = document.createElement('button'); deleteBtn.textContent='Delete';
    loadBtn.addEventListener('click', ()=> loadImageToEditor(item.dataURL));
    applyBtn.addEventListener('click', ()=> { document.body.style.cursor = `url(${item.dataURL}) 0 0, auto`; alert('Đã áp dụng con trỏ.'); });
    reportBtn.addEventListener('click', ()=> { alert('Cảm ơn — báo cáo sẽ gửi đến admin (demo local, không có server).'); });
    deleteBtn.addEventListener('click', ()=> {
      if(currentUser !== item.author){ alert('Bạn chỉ có thể xóa con trỏ mình đã đăng'); return; }
      if(!confirm('Xóa bài đăng cộng đồng này?')) return;
      community = loadCommunity();
      const idx = community.findIndex(c=>c.id===item.id);
      if(idx>=0){ community.splice(idx,1); saveCommunity(community); renderCommunity(); alert('Đã xóa.'); }
    });
    [loadBtn,applyBtn,reportBtn,deleteBtn].forEach(b=> b.style.margin='4px');
    right.appendChild(loadBtn); right.appendChild(applyBtn); right.appendChild(reportBtn);
    if(item.author === currentUser) right.appendChild(deleteBtn);
    el.appendChild(left); el.appendChild(right);
    communityGalleryEl.appendChild(el);
  });
}

/* helper to load image dataURL into editor */
function loadImageToEditor(dataURL){
  const img = new Image();
  img.onload = ()=> {
    const w=img.width, h=img.height, size=Math.max(w,h);
    resizeGrid(size);
    const tmp = document.createElement('canvas'); tmp.width=w; tmp.height=h; const tctx=tmp.getContext('2d'); tctx.drawImage(img,0,0,w,h);
    const data = tctx.getImageData(0,0,w,h).data;
    for(let yy=0; yy<size; yy++){ for(let xx=0; xx<size; xx++){
      const i = ((yy%h)*w + (xx%w))*4; const r=data[i], g=data[i+1], b=data[i+2], a=data[i+3];
      pixels[yy][xx] = a>0 ? `rgba(${r},${g},${b},${(a/255).toFixed(3)})` : null;
    } }
    drawGrid();
  };
  img.src = dataURL;
}

/* helper escape */
function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

/* reset all local data (debug) */
resetAllBtn.addEventListener('click', ()=> {
  if(!confirm('Xóa toàn bộ dữ liệu local (users + community)?')) return;
  localStorage.removeItem(LS_USERS); localStorage.removeItem(LS_COMMUNITY);
  users = {}; community = []; currentUser = null; renderAuth(); alert('Đã xóa.');
});

/* init */
renderAuth(); drawGrid(); // initial draw
renderCommunity();

/* ensure UI bindings for elements that are created earlier */
document.getElementById('savePNG').addEventListener('click', ()=> savePNG.click());
document.getElementById('importPNG').addEventListener('click', ()=> importPNG.click());
document.getElementById('importPNG').addEventListener('click', ()=> { /* noop, already */});
document.getElementById('importPNG').addEventListener('keydown', ()=>{});
document.querySelector('#topbar').addEventListener('click', ()=>{ /* keep interactive */ });

</script>
</body>
</html>
